#!/usr/bin/env python
import argparse
import os

from fuel import converters


if __name__ == "__main__":
    built_in_datasets = dict(converters.all_converters)
    parser = argparse.ArgumentParser(
        description='Conversion script for built-in datasets.')
    subparsers = parser.add_subparsers()
    parent_parser = argparse.ArgumentParser(add_help=False)
    parent_parser.add_argument(
        "-d", "--directory", help="directory in which input files reside",
        type=str, default=os.getcwd())
    for name, subparser_fn in built_in_datasets.items():
        subparser = subparsers.add_parser(
            name, parents=[parent_parser],
            help='Convert the {} dataset'.format(name))
        subparser.add_argument(
            "-o", "--output-file", help="where to save the dataset", type=str,
            default=os.path.join(os.getcwd(), '{}.hdf5'.format(name)))
        subparser_fn(subparser)
    args = parser.parse_args()
    args_dict = vars(args)
    func = args_dict.pop('func')
    func(**args_dict)
